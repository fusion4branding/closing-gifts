<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>D.R. Horton — Gift Builder</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root { --drh-navy:#182757; }
    body { -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
  </style>
</head>
<body class="bg-slate-50 text-slate-800">
  <div id="root"></div>

  <!-- React (UMD) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <script>
  // ================= CONFIG =================
  const ENDPOINT_URL = "https://script.google.com/macros/s/AKfycbyMRTpMiGD_d56NPpoXxlwZdwXaLpcOAtUq_kGC7zNH2kljgDp_PfX7tEC2TrGXc3Z70g/exec";
  const ADMIN_EMAIL  = "roselleralegre2019@gmail.com";
  const SITE_NAME    = "D.R. Horton — Welcome Gift";
  // ==========================================

  const { useMemo, useState, useEffect } = React;

  // ---------- Visual helpers ----------
  function Icon({kind, className}) {
    const c = className || 'w-14 h-14 text-slate-400';
    if(kind==='mug')      return React.createElement('svg',{viewBox:'0 0 128 128',className:c},React.createElement('rect',{x:28,y:28,width:56,height:64,rx:8,fill:'currentColor'}),React.createElement('rect',{x:84,y:40,width:16,height:28,rx:6,fill:'currentColor'}));
    if(kind==='pen')      return React.createElement('svg',{viewBox:'0 0 128 128',className:c},React.createElement('path',{d:'M20 100l16 8 64-64-16-8z',fill:'currentColor'}),React.createElement('rect',{x:86,y:26,width:16,height:16,fill:'currentColor'}));
    if(kind==='towel')    return React.createElement('svg',{viewBox:'0 0 128 128',className:c},React.createElement('path',{d:'M32 24h56v80H32z',fill:'currentColor'}),React.createElement('path',{d:'M32 44h56',stroke:'currentColor','strokeWidth':6}));
    if(kind==='notebook') return React.createElement('svg',{viewBox:'0 0 128 128',className:c},React.createElement('rect',{x:30,y:18,width:56,height:92,rx:6,fill:'currentColor'}),React.createElement('rect',{x:38,y:30,width:32,height:6,fill:'currentColor'}));
    if(kind==='box')      return React.createElement('svg',{viewBox:'0 0 128 128',className:c},React.createElement('path',{d:'M16 40l48-16 48 16-48 16z',fill:'currentColor'}),React.createElement('path',{d:'M24 44v44l40 16V60zM104 44v44L64 104V60z',fill:'currentColor'}));
    return React.createElement('div',{className:'w-14 h-14 rounded-lg bg-slate-300'});
  }

  // Product image with webp → png fallback
  function ProductImage({ id, alt, className }) {
    const webp = `img/${id}.webp`;
    const png  = `img/${id}.png`;
    return React.createElement('img', {
      alt, src: webp,
      className: className || 'max-w-full max-h-full object-contain object-center select-none pointer-events-none',
      draggable: false,
      onError: (e) => { e.currentTarget.onerror = null; e.currentTarget.src = png; }
    });
  }

  // ---------- Catalog ----------
  // base = MOQ unit price; moq = MOQ quantity
  const CATALOG_RAW = [
    // Core / existing items (kept)
    { id:"cutting_board_two_tone",      name:'11" Two-Tone Cutting Board',                          base:8.67,  moq:48,  img:"notebook" },
    { id:"gift_box_magnetic_15x12",     name:'15" × 12" Magnetic Gift Box (sold empty)',            base:8.95,  moq:20,  img:"box"      },
    { id:"tumbler_oasis_20oz",          name:'Oasis-I 20 oz Stainless Steel Tumbler (Double Walled)', base:11.90, moq:36, img:"mug"      },
    { id:"camp_mug_14oz",               name:'14 oz Powder-Coated Camping Mug',                     base:15.95, moq:48,  img:"mug"      },
    { id:"tool_kit_26pc_deluxe",        name:'26-Piece Deluxe Tool Kit',                            base:17.64, moq:40,  img:"pen"      },
    { id:"screwdriver_artisan_20pc",    name:'Best Buddy Tools® Artisan Screwdriver Set (20-pc)',   base:12.25, moq:30,  img:"pen"      },
    { id:"deluxe_household_tool_set",   name:'Deluxe Household Tool Set (case)',                    base:58.59, moq:12,  img:"pen"      },

    // Additional items (now all priced w/ MOQ)
    { id:"tea_towel_rpet",              name:'Sublimated RPET Tea Towel',                           base:5.15,  moq:100, img:"towel"    },
    { id:"pizza_cutter_mammamia",       name:'Mamma Mia Pizza Cutter',                              base:4.56,  moq:100, img:"pen"      },
    { id:"coaster_marble_octagon",      name:'Marble Octagon Coaster',                              base:6.83,  moq:50,  img:"notebook" },
    { id:"potholder_heavy",             name:'Heavy-Duty Potholder',                                base:6.22,  moq:100, img:"towel"    },
    { id:"silicone_ice_cube_maker",     name:'Silicone Ice Cube Maker & Bucket',                    base:8.83,  moq:75,  img:"towel"    },
    { id:"icecream_pint_cooler",        name:'American-Made Full Color Ice Cream Pint Cooler',      base:5.68,  moq:250, img:"towel"    },
    { id:"workit_gloves",               name:'Workit All Purpose Gloves',                           base:8.35,  moq:50,  img:"pen"      },
    { id:"teak_spoon_holder",           name:'Noble Teak Wood Spoon Holder',                        base:6.11,  moq:75,  img:"notebook" },
    { id:"foam_handle_ice_scraper",     name:'Foam Handle Ice Scraper',                             base:3.70,  moq:100, img:"pen"      },
    { id:"cargo_org_with_cooler",       name:'Cargo Organizer with Cooler',                         base:16.69, moq:40,  img:"box"      },
    { id:"snowbrush_super_deluxe",      name:'Super Deluxe Snowbrush Ice Scraper',                  base:8.27,  moq:50,  img:"pen"      },
    { id:"car_caddy",                   name:'Car Caddy',                                           base:3.77,  moq:100, img:"box"      },
    { id:"fleece_roll_blanket",         name:'Fleece Roll Up Blanket',                              base:10.49, moq:75,  img:"towel"    },
    { id:"oceanside_keychain_blue",     name:'Oceanside Leather Key Chain — Blue',                  base:5.13,  moq:250, img:"pen"      },

    // Hank’s Good/Better/Best items
    { id:"yacht_club_boat_tote",        name:'Yacht Club Boat Tote — 20.5" × 13" × 6.7"',           base:13.98, moq:25,  img:"box"      },
    { id:"ceramic_bowl_candle_16oz",    name:'16 oz Ceramic Bowl Candle',                           base:24.00, moq:48,  img:"mug"      },
    { id:"coaster_slate_square",        name:'Square Slate Coaster',                                base:5.18,  moq:50,  img:"notebook" },
    { id:"marshalls_tool_set",          name:'Marshalls Tool Set (18-pc)',                          base:16.37, moq:25,  img:"pen"      },
    { id:"nbn_whitby_24can_cooler",     name:'NBN Whitby 24-Can Backpack Cooler',                   base:37.15, moq:24,  img:"towel"    },
    { id:"headlamp_starlight",          name:'Best Buddy Tools® Starlight Rechargeable LED Headlamp', base:11.31, moq:30, img:"pen"      },
    { id:"flux_wall_charger_holder",    name:'Flux Wall Charger & Phone Holder (Type-C, USB & AC)', base:14.90, moq:30,  img:"pen"      },
    { id:"stark_2_bluetooth_speaker",   name:'Stark 2.0 Bluetooth® Speaker',                        base:21.40, moq:50,  img:"pen"      },
  ];

  // Derived, sorted catalog (by price asc; tie-breaker name)
  const CATALOG = [...CATALOG_RAW].sort((a,b)=>{
    if (a.base !== b.base) return a.base - b.base;
    return a.name.localeCompare(b.name);
  });

  // Hank’s Pre-Built Sets
  const RECOMMENDED_SETS = [
    { id:'good',   label:"Good",   thumb:'reco_good',
      items:['gift_box_magnetic_15x12','tumbler_oasis_20oz','cutting_board_two_tone'] },
    { id:'better', label:"Better", thumb:'reco_better',
      items:['yacht_club_boat_tote','ceramic_bowl_candle_16oz','coaster_slate_square','marshalls_tool_set'] },
    { id:'best',   label:"Best",   thumb:'reco_best',
      items:['nbn_whitby_24can_cooler','headlamp_starlight','camp_mug_14oz','flux_wall_charger_holder','stark_2_bluetooth_speaker'] },
  ];

  const BOX_TIERS = [
    { id:"starter",  name:"Starter Kit",  slots:3, pack:4.00 },
    { id:"standard", name:"Standard Kit", slots:4, pack:6.00 },
    { id:"premium",  name:"Premium Kit",  slots:5, pack:9.00 },
  ];

  // ---------- App ----------
  function App(){
    const [tier,setTier]         = useState(BOX_TIERS[1]);
    const [selected,setSelected] = useState([]);
    const [qty,setQty]           = useState(25);
    const [division,setDivision] = useState('');
    const [name,setName]         = useState('');
    const [email,setEmail]       = useState('');
    const [phone,setPhone]       = useState('');
    const [sending,setSending]   = useState(false);
    const [error,setError]       = useState('');

    const requiredQty = useMemo(
      () => Math.max(1, ...selected.map(id => (CATALOG.find(i=>i.id===id)?.moq || 1))),
      [selected]
    );
    useEffect(() => { if (qty < requiredQty) setQty(requiredQty); }, [requiredQty]);

    const remaining = tier.slots - selected.length;

    const priceEach = useMemo(()=>{
      const items = selected.map(id => CATALOG.find(i=>i.id===id));
      const itemSum = items.reduce((s,i)=> s + (i?.base ?? 0), 0);
      return (items.length>0) ? (itemSum + tier.pack).toFixed(2) : '0.00';
    },[selected,tier]);

    const total = useMemo(()=> (qty * parseFloat(priceEach||0)).toFixed(2), [qty, priceEach]);

    function toggle(id){
      setSelected(prev =>
        prev.includes(id)
          ? prev.filter(x => x !== id)
          : (prev.length < tier.slots ? [...prev, id] : prev)
      );
    }

    function onTierClick(b){
      setTier(b);
      setSelected([]); // clear when switching tiers
    }

    function chooseSet(set) {
      const items = set.items.slice(0, set.items.length);
      const t = BOX_TIERS.find(x => x.slots === items.length) || tier;
      setTier(t);
      setSelected(items);
    }

    function SetCard({set}) {
      const first   = CATALOG.find(i => i.id === set.items[0]);
      const thumbId = set.thumb || (first ? first.id : null);
      const active  = selected.length === set.items.length &&
                      set.items.every(id => selected.includes(id));
      return React.createElement('button', {
        onClick: () => chooseSet(set),
        className:
          `group rounded-2xl border p-6 text-left transition bg-white
           ${active ? 'border-[var(--drh-navy)] ring-2 ring-[var(--drh-navy)]' : 'border-slate-200 hover:shadow-md'}`
      },
        React.createElement('div', { className:'flex items-center gap-4' },
          React.createElement('div', {
            className:'h-16 w-16 md:h-20 md:w-20 rounded-xl bg-white ring-1 ring-slate-200 grid place-items-center overflow-hidden'
          },
            thumbId
              ? React.createElement(ProductImage, { id:thumbId, alt:set.label+' set' })
              : React.createElement(Icon, { kind:'box', className:'w-full h-full text-slate-400' })
          ),
          React.createElement('div', { className:'min-w-0' },
            React.createElement('div', { className:'text-lg md:text-xl font-semibold' }, set.label),
            React.createElement('div', { className:'text-xs text-slate-500' }, `${set.items.length} items`)
          )
        )
      );
    }

    // Grid columns: keep 2×2 for 4; use 3 cols otherwise
    const previewColsClass = tier.slots === 4 ? 'grid-cols-2' : 'grid-cols-3';
    const centerGrid       = tier.slots === 4 ? '' : 'place-content-center';

    async function submit(){
      setError('');
      if(!email){ setError('Please enter a contact email.'); return; }
      setSending(true);

      const payload = {
        admin: ADMIN_EMAIL,
        site: SITE_NAME,
        name,
        division,
        email,
        phone,
        tier: { id:tier.id, name:tier.name, slots:tier.slots, pack:tier.pack },
        qty,
        priceEach,
        total,
        items: selected.map(id => {
          const i = CATALOG.find(x=>x.id===id)||{};
          return { id, name:i.name || id, moq:i.moq || 1, unitPrice:i.base };
        }),
      };

      try{
        const res = await fetch(ENDPOINT_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'text/plain' },
          body: JSON.stringify(payload),
        });
        const txt = await res.text();
        if(!res.ok) throw new Error('Server '+res.status+': '+txt);
        window.location.href = '../thankyou/';
      }catch(err){
        console.error(err);
        setError('Checkout failed. '+String(err).slice(0,300));
      }finally{
        setSending(false);
      }
    }

    // ---------- UI ----------
    return React.createElement('div', null,
      // Header bar
      React.createElement('header',{className:'sticky top-0 z-30 bg-[var(--drh-navy)] text-white'},
        React.createElement('div',{className:'max-w-6xl mx-auto px-4 py-4 flex items-center justify-between'},
          React.createElement('a',{ href: '../', className:'flex items-center' },
            React.createElement('img',{ src:'img/drh-logo-white.png', alt:'D.R. Horton', className:'h-12 md:h-14 w-auto select-none', decoding:'async', loading:'eager' })
          ),
          React.createElement('div',{className:'flex items-center gap-6 text-sm'},
            React.createElement('div',null,
              React.createElement('div',{className:'text-white/80'},'Estimate / ea'),
              React.createElement('div',{className:'text-lg font-semibold'}, '$'+priceEach)
            ),
            React.createElement('div',null,
              React.createElement('div',{className:'text-white/80'},'Order Qty'),
              React.createElement('div',{className:'text-lg font-semibold'},qty)
            )
          )
        )
      ),

      // Main grid
      React.createElement('main',{className:'max-w-6xl mx-auto px-4 py-6 grid lg:grid-cols-5 gap-6'},

        // Hank’s Pre-Built Sets
        React.createElement('div', { className:'lg:col-span-5' },
          React.createElement('h2', { className:'text-2xl md:text-3xl font-semibold text-[var(--drh-navy)] text-center mb-4' }, "Hank’s Pre-Built Sets"),
          React.createElement('div', { className:'max-w-5xl mx-auto grid grid-cols-[repeat(auto-fit,minmax(220px,1fr))] gap-4' },
            RECOMMENDED_SETS.map(s => React.createElement(SetCard, { key:s.id, set:s }))
          ),
          React.createElement('h2', { className:'mt-4 text-2xl md:text-3xl font-semibold text-[var(--drh-navy)] text-center' }, 'Create Your Own Kit')
        ),

        // Left column: Select Kit + Select Items
        React.createElement('section',{className:'lg:col-span-3 space-y-6'},

          // 1) Select Kit
          React.createElement('div',{className:'bg-white rounded-2xl shadow-sm p-5 border border-slate-200'},
            React.createElement('div',{className:'flex items-start justify-between'},
              React.createElement('div',null,
                React.createElement('h2',{className:'text-lg font-semibold'},'1) Select Kit'),
                React.createElement('p',{className:'text-sm text-slate-500'},'Pick a tier, choose items, and set your quantity.')
              ),
              React.createElement('button',{onClick:()=>{setTier(BOX_TIERS[1]); setSelected([]);},className:'text-sm px-3 py-1.5 rounded-lg border border-slate-300 hover:bg-slate-50'},'Reset')
            ),
            React.createElement('div',{className:'mt-4 grid md:grid-cols-3 gap-3'},
              BOX_TIERS.map(b => React.createElement('button',{
                  key:b.id,
                  onClick:()=>onTierClick(b),
                  className:`relative rounded-2xl border p-4 text-left transition hover:shadow ${tier.id===b.id?'border-[var(--drh-navy)] ring-1 ring-[var(--drh-navy)]':'border-slate-200'}`
                },
                React.createElement('div',{className:'h-8 w-8 rounded-xl bg-[var(--drh-navy)] grid place-items-center text-white mb-2'},'📦'),
                React.createElement('div',{className:'font-medium'},b.name),
                React.createElement('div',{className:'text-xs text-slate-500'},`Up to ${b.slots} items • Packing $${b.pack.toFixed(2)}`),
                tier.id===b.id && React.createElement('span',{className:'absolute top-3 right-3 text-emerald-600'},'✔')
              ))
            ),
            React.createElement('div',{className:'mt-4 grid sm:grid-cols-3 gap-3'},
              React.createElement('label',{className:'block'},
                React.createElement('span',{className:'text-xs text-slate-500'},'Division'),
                React.createElement('input',{value:division,placeholder:'e.g., North Dallas',onChange:e=>setDivision(e.target.value),className:'mt-1 w-full rounded-xl border border-slate-300 px-3 py-2'})
              ),
              React.createElement('label',{className:'block'},
                React.createElement('span',{className:'text-xs text-slate-500'},'Order Quantity'),
                React.createElement('input',{ type:'number', min:requiredQty, step:5, value:qty,
                  onChange:e=>setQty(Math.max(requiredQty, parseInt(e.target.value||requiredQty))),
                  className:'mt-1 w-full rounded-xl border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[var(--drh-navy)]'})
              ),
              React.createElement('div',{className:'rounded-xl bg-slate-100 p-3 text-sm'},
                React.createElement('div',{className:'flex items-center gap-2'},'ℹ️','Remaining Slots'),
                React.createElement('div',{className:`mt-1 text-lg font-semibold ${remaining<0?'text-rose-600':''}`}, remaining>=0?remaining:0)
              )
            )
          ),

          // 2) Select Items (sorted by price asc)
          React.createElement('div',{className:'bg-white rounded-2xl shadow-sm p-5 border border-slate-200'},
            React.createElement('h2',{className:'text-lg font-semibold'},'2) Select Items'),
            React.createElement('p',{className:'text-sm text-slate-500'},'Sorted by price (lowest to highest).'),
            React.createElement('div',{className:'mt-4 max-h-[60vh] overflow-y-auto pr-1'},
              React.createElement('div',{className:'grid sm:grid-cols-2 lg:grid-cols-3 gap-4'},
                CATALOG.map(item => {
                  const active   = selected.includes(item.id);
                  const disabled = !active && selected.length >= tier.slots;
                  return React.createElement('button',{
                      key:item.id, onClick:()=>toggle(item.id),
                      className:`group rounded-2xl border p-4 text-left transition ${active?'border-[var(--drh-navy)] ring-1 ring-[var(--drh-navy)] shadow':'border-slate-200 hover:shadow'} ${disabled?'opacity-40 pointer-events-none':''}`
                    },
                    React.createElement('div',{className:'relative'},
                      React.createElement('div',{className:'aspect-[4/3] w-full rounded-xl bg-white flex items-center justify-center overflow-hidden'},
                        React.createElement(ProductImage, { id:item.id, alt:item.name })
                      ),
                      active && React.createElement('span',{className:'absolute -top-2 -right-2 h-7 w-7 rounded-full bg-[var(--drh-navy)] text-white grid place-items-center'},'✔')
                    ),
                    React.createElement('div',{className:'mt-3 font-medium'},item.name),
                    React.createElement('div',{className:'mt-1 text-sm'},'$'+item.base.toFixed(2)),
                    React.createElement('div',{className:'text-[11px] text-slate-500'},'MOQ ', item.moq || 1)
                  );
                })
              )
            )
          )
        ),

        // Right column: Box Preview + Summary
        React.createElement('section',{className:'lg:col-span-2 space-y-6'},

          // 3) Preview your full project
          React.createElement('div',{className:'bg-white rounded-2xl shadow-sm p-5 border border-slate-200'},
            React.createElement('h2',{className:'text-lg font-semibold'},'3) Preview your full project'),
            React.createElement('div',{className:'mt-4 aspect-square rounded-2xl bg-slate-100 p-4'},
              React.createElement('div',{className:`h-full w-full rounded-xl border-2 border-dashed border-slate-300 grid ${previewColsClass} ${centerGrid} gap-3 p-3`},
                Array.from({length:tier.slots}).map((_, idx) => {
                  const id   = selected[idx];
                  const item = CATALOG.find(i=>i.id===id);
                  return React.createElement('div',{ key:idx, className:'rounded-xl border border-slate-200 bg-white p-2 grid grid-rows-[1fr_auto] justify-items-stretch' },
                    id
                      ? React.createElement(React.Fragment,null,
                          React.createElement('div',{className:'w-full aspect-[4/3] rounded-md bg-white flex items-center justify-center overflow-hidden'},
                            React.createElement(ProductImage,{ id:item.id, alt:item.name })
                          ),
                          React.createElement('div',{className:'mt-1 text-[11px] text-center text-slate-600 truncate', title:item.name}, item.name)
                        )
                      : React.createElement('div',{className:'h-full grid place-items-center text-xs text-slate-400'},'Empty Slot')
                  );
                })
              ),
              React.createElement('div',{className:'mt-2 text-center text-xs text-slate-600'},'D.R. Horton Logo')
            )
          ),

          // 4) Summary
          React.createElement('div',{className:'bg-white rounded-2xl shadow-sm p-5 border border-slate-200'},
            React.createElement('h2',{className:'text-lg font-semibold'},'4) Summary'),
            React.createElement('div',{className:'mt-2 space-y-2 text-sm'},
              React.createElement('div',{className:'flex items-center justify-between'},React.createElement('span',null,'Box Tier'),React.createElement('span',{className:'font-medium'},tier.name)),
              React.createElement('div',{className:'flex items-center justify-between'},React.createElement('span',null,'Items Selected'),React.createElement('span',{className:'font-medium'},selected.length,' / ',tier.slots)),
              React.createElement('div',{className:'flex items-center justify-between'},React.createElement('span',null,'Estimated Price / ea'),React.createElement('span',{className:'font-semibold'}, '$'+priceEach)),
              React.createElement('div',{className:'flex items-center justify-between'},React.createElement('span',null,'Order Quantity'),React.createElement('span',{className:'font-medium'},qty)),
              React.createElement('div',{className:'flex items-center justify-between'},React.createElement('span',null,'Rough Total'),React.createElement('span',{className:'font-semibold'}, '$'+total))
            ),
            React.createElement('div',{className:'mt-4 grid gap-3'},
              React.createElement('label',{className:'block'},
                React.createElement('span',{className:'text-xs text-slate-500'},'First & Last Name'),
                React.createElement('input',{type:'text',placeholder:'Your name',value:name,onChange:e=>setName(e.target.value),className:'mt-1 w-full rounded-xl border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[var(--drh-navy)]'})
              ),
              React.createElement('label',{className:'block'},
                React.createElement('span',{className:'text-xs text-slate-500'},'Contact Email (required)'),
                React.createElement('input',{type:'email',placeholder:'you@company.com',value:email,onChange:e=>setEmail(e.target.value),className:'mt-1 w-full rounded-xl border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[var(--drh-navy)]'})
              ),
              React.createElement('label',{className:'block'},
                React.createElement('span',{className:'text-xs text-slate-500'},'Phone (optional)'),
                React.createElement('input',{type:'tel',placeholder:'(555) 555-5555',value:phone,onChange:e=>setPhone(e.target.value),className:'mt-1 w-full rounded-xl border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[var(--drh-navy)]'})
              ),
              React.createElement('button',{
                  onClick:submit,
                  disabled:sending,
                  className:`px-4 py-2 rounded-xl text-white ${sending?'bg-slate-400':'bg-[var(--drh-navy)] hover:opacity-90'}`
                },
                sending ? 'Processing…' : 'Checkout'
              ),
              error && React.createElement('div',{className:'text-rose-600 text-sm'},error)
            )
          )
        )
      )
    ); // end return
  }

  const root = ReactDOM.createRoot(document.getElementById('root'));
  root.render(React.createElement(App));
  </script>
</body>
</html>
